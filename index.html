
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="getting_started/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Structured Streamer</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#structured-streamer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Structured Streamer" class="md-header__button md-logo" aria-label="Structured Streamer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Structured Streamer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              About
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Structured Streamer" class="md-nav__button md-logo" aria-label="Structured Streamer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Structured Streamer
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-use-structured-streamer" class="md-nav__link">
    <span class="md-ellipsis">
      Why Use Structured Streamer?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Use Structured Streamer?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" class="md-nav__link">
    <span class="md-ellipsis">
      Main Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-component" class="md-nav__link">
    <span class="md-ellipsis">
      Example Component
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Component Streaming
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    <span class="md-ellipsis">
      Other
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="parsing_streams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="benchmarks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmarks
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="limitations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Limitations
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-use-structured-streamer" class="md-nav__link">
    <span class="md-ellipsis">
      Why Use Structured Streamer?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Use Structured Streamer?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" class="md-nav__link">
    <span class="md-ellipsis">
      Main Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-component" class="md-nav__link">
    <span class="md-ellipsis">
      Example Component
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Component Streaming
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    <span class="md-ellipsis">
      Other
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div align="center">

<img src="https://raw.githubusercontent.com/PrestonBlackburn/structured_streamer/refs/heads/gh-pages/img/logo_bg_wide.png" alt="Struct Strm Logo" width="750" role="img">


</div>

<h1 id="structured-streamer">Structured Streamer<a class="headerlink" href="#structured-streamer" title="Permanent link">&para;</a></h1>
<p><strong>struct_strm</strong> (structured streamer) is a Python package that makes it easy to stream partial json generated by LLMs into valid json responses. This enables partial rendering of UI components without needing to wait for a full response, drastically reducing the time to the first word on the user's screen.</p>
<h2 id="why-use-structured-streamer">Why Use Structured Streamer?<a class="headerlink" href="#why-use-structured-streamer" title="Permanent link">&para;</a></h2>
<p>JSON format is the standard when dealing with structured responses from LLMs. In the early days of LLM structured generation we had to validate the JSON response only after the whole JSON response had been returned. Modern approaches use constrained decoding to ensure that only valid json is returned, eliminating the need for post generation validation, and allowing us to use the response imediately. However, the streamed json response is incomplete, so it can't be parsed using traditional methods. This library aims to make it easier to handle this partially generated json to provide a better end user experience. <br />
See the <a href="benchmarks/">benchmarks</a> section in the docs for more details about how this library can speed up your structured response processing. </p>
<p><br/></p>
<p>You can learn more about constrained decoding and context free grammar here: <a href="https://blog.mlc.ai/2024/11/22/achieving-efficient-flexible-portable-structured-generation-with-xgrammar">XGrammar - Achieving Efficient, Flexible, and Portable Structured Generation with XGrammar</a>   </p>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>struct-strm
</code></pre></div></td></tr></table></div>
<p><br/></p>
<h2 id="main-features">Main Features<a class="headerlink" href="#main-features" title="Permanent link">&para;</a></h2>
<p>The primary feature is to wrap LLM outputs to produce valid incremental JSON from partial invalid JSON based on user provided structures. Effectively this acts as a wrapper for your LLM calls. Due to the nature of this library (it is primarily inteded for use in web servers), it is expected that it will be used in async workflows, and is async first.   </p>
<p>The library also provides simple HTML templates that serve as examples of how you can integrate the streams in your own components.  </p>
<p>Due to the nature of partial json streaming, there can be "wrong" ways to stream responses that are not effective for partial rendering of responeses in the UI. The library also provides examples of tested ways to apply the library to get good results.   </p>
<p><strong>High Level Flow</strong><br />
<img alt="High level flow" src="https://raw.githubusercontent.com/PrestonBlackburn/structured_streamer/refs/heads/main/docs/img/high_level_flow.png" /></p>
<h2 id="example-component">Example Component<a class="headerlink" href="#example-component" title="Permanent link">&para;</a></h2>
<p>This is an example of a form component being incrementally rendered. By using a structured query response from an LLM, in this case a form with form field names and field placeholders, we can stream the form results directly to a HTML component. This drastically reduces the time to first token, and the precieved time that a user needs to wait. More advanced components are under development. </p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">stuct_strm</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_openai</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncOpenAI</span>

<span class="o">...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DefaultFormItem</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">field_placeholder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DefaultFormStruct</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">form_fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DefaultFormItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>


<span class="n">stream_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4.1&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
    <span class="n">response_format</span><span class="o">=</span><span class="n">DefaultFormStruct</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> 

<span class="n">form_struct_response</span> <span class="o">=</span> <span class="n">parse_openai</span><span class="p">(</span><span class="n">DefaultFormStruct</span><span class="p">,</span> <span class="n">stream_response</span><span class="p">)</span>
<span class="k">async</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">form_struct_response</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">formstruct</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">formstruct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Fully formed python classes are returned:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt;&gt;&gt;<span class="w">  </span>DefaultFormStruct<span class="o">(</span><span class="nv">form_fields</span><span class="o">=[</span>DefaultFormItem<span class="o">(</span><span class="nv">field_name</span><span class="o">=</span><span class="s2">&quot;fruits&quot;</span>,<span class="w"> </span><span class="nv">field_placeholder</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">)])</span>
&gt;&gt;&gt;<span class="w">  </span>DefaultFormStruct<span class="o">(</span><span class="nv">form_fields</span><span class="o">=[</span>DefaultFormItem<span class="o">(</span><span class="nv">field_name</span><span class="o">=</span><span class="s2">&quot;fruits&quot;</span>,<span class="w"> </span><span class="nv">field_placeholder</span><span class="o">=</span><span class="s2">&quot;apple &quot;</span><span class="o">)])</span>
&gt;&gt;&gt;<span class="w">  </span>DefaultFormStruct<span class="o">(</span><span class="nv">form_fields</span><span class="o">=[</span>DefaultFormItem<span class="o">(</span><span class="nv">field_name</span><span class="o">=</span><span class="s2">&quot;fruits&quot;</span>,<span class="w"> </span><span class="nv">field_placeholder</span><span class="o">=</span><span class="s2">&quot;apple orange strawberry&quot;</span><span class="o">)])</span>
&gt;&gt;&gt;<span class="w">  </span>etc....
</code></pre></div></td></tr></table></div></p>
<p>And the corresponding incomplete json string streams would have looked like:
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt;&gt;&gt; &quot;{&quot;form_fields&quot;: [{&quot;field_name&quot;: &quot;fruits&quot;
&gt;&gt;&gt; &quot;{&quot;form_fields&quot;: [{&quot;field_name&quot;: &quot;fruits&quot;, &quot;field_placeholder&quot;: &quot;apple &quot;
&gt;&gt;&gt; &quot;{&quot;form_fields&quot;: [{&quot;field_name&quot;: &quot;fruits&quot;, &quot;field_placeholder&quot;: &quot;apple orange strawberry&quot;}
&gt;&gt;&gt; etc...
</code></pre></div></td></tr></table></div></p>
<h3 id="component-streaming">Component Streaming<a class="headerlink" href="#component-streaming" title="Permanent link">&para;</a></h3>
<p>The structured responses can then be easily used to generate incrementally rendered web components.<br />
For example this form:   </p>
<p><img alt="Example Form Streaming" src="https://raw.githubusercontent.com/PrestonBlackburn/structured_streamer/refs/heads/main/docs/img/form_struct_strm.gif" /></p>
<p><br/></p>
<p>Or we can return data in a grid in more interesting ways.<br />
For example this rubric:   </p>
<p><img alt="Example Rubric Streaming" src="img/rubric_example.gif" /></p>
<h2 id="other">Other<a class="headerlink" href="#other" title="Permanent link">&para;</a></h2>
<p>I started <strong>struct_strm</strong> to support another project I'm working on to provide an easy entrypoint for Teachers to use LLM tools in their workflows. Check it out if you're interested - <a href="https://www.teacherspet.tech/">Teachers PET</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
        
          
          <a href="getting_started/" class="md-footer__link md-footer__link--next" aria-label="Next: Getting Started">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Getting Started
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.footer", "content.action.edit"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="search/main.js"></script>
      
    
  </body>
</html>